Плагин типографирования на базе Типографа Муравьева
===============

Данный репозиторий содержит PSR-4 совместимый пакет Composer, созданный на основе кода [Типографа Муравьева](http://mdash.ru/)

Evgeny Muravjev Typograph, http://mdash.ru
Authors: Evgeny Muravjev & Alexander Drutsa

### Установка

Для установки с помощью Composer, выполните команду:

```bash
composer require valtu4a/typograph
```


### Настройка плагина

Одиночный набор настроек можно задать следующим образом:
```php
$this->typographer->setup([
    'OptAlign.all' => 'off',
    'Text.paragraphs' => 'off',
    'Text.breakline' => 'off',
    'Number.numeric_sub' => 'off'
]);
```
Одиночные настройки можно задать в виде массива:

```php
$this->typographer->setup([
    'map' => [
        'OptAlign' => true,  
        'Text' => ['paragraphs', 'breakline'],
        'Number' => ['numeric_sub'],
        'Punctuation' => ['dot_on_end'],
     ],
    'map_disable' => true, // отключить указанные правила
    'map_strict' => false  // остальные не трогать
]);
```

Множественный набор настроек можно задать для каждого трейта в виде массива:
```php
$this->typographer->setup([
            'maps' => [
                [
                    'map' => [
                        'OptAlign' => true,
                        'Text' => ['paragraphs', 'breakline'],
                        'Number' => ['numeric_sub'],
                        'Punctuation' => ['dot_on_end'],
                    ],
                    'disable' => true,
                    'strict' => false
                ]
            ]
        ]);

```

#### Как полностью отключить свойство на примере `OptAlign`

```php
$this->typographer->setup([
            'map' => [
                'OptAlign' => true,       // всё
                'Text' => ['paragraphs', 'breakline'],
                'Number' => ['numeric_sub'],
                'Punctuation' => ['dot_on_end'],
            ],
            'map_disable' => true,
            'map_strict' => true
        ]);

````
* `OptAlign => true` + `disable => true` отключит весь трейт.
* `map_strict => true` отключит все остальные трейты тоже.

Если `strict = false`, нужно указать всё, что необходимо отключить.
Иначе `set_enable_map()` просто оставляет включёнными другие правила:

```php
$this->typographer->setup([
    'map' => [
        'OptAlign' => ['all', 'quote', 'oa_oquote', 'oa_obracket'], // перечислить вручную всё, что нужно
        'Text' => ['paragraphs', 'breakline'],
        'Number' => ['numeric_sub']
    ],
    'map_disable' => true,
    'map_strict' => false
]);

```

----
### Доступные трейты и их свойства

| Трейт | Свойство | Описание |
|-------|----------|-----------|
| **Abbr** (Сокращения) | `nobr_abbreviation` | Расстановка пробелов перед сокращениями dpi, lpi |
| | `nobr_acronym` | Расстановка пробелов перед сокращениями гл., стр., рис., илл., ст., п. |
| | `nobr_sm_im` | Расстановка пробелов перед сокращениями см., им. |
| | `nobr_locations` | Расстановка пробелов в сокращениях г., ул., пер., д. |
| | `nbsp_before_unit` | Привязка сокращений в размерных величинах (м, см, м²) |
| | `nbsp_before_weight_unit` | Привязка сокращений в весовых величинах (г, кг, мг) |
| | `nobr_before_unit_volt` | Установка пробелов в сокращении вольт |
| | `ps_pps` | Объединение сокращений P.S., P.P.S. |
| | `nobr_itd_itp` | Объединение сокращений и т.д., и т.п., в т.ч. |
| | `nbsp_te` | Обработка сокращения т.е. |
| | `nbsp_money_abbr` | Форматирование денежных сокращений (руб., $, €) |
| | `nbsp_money_abbr_rev` | Привязка валюты к числу спереди (€100, $50) |
| | `nbsp_org_abbr` | Привязка сокращений форм собственности (ООО, ЗАО) |
| | `nobr_gost` | Привязка сокращения ГОСТ к номеру |
| **Dash** (Дефисы и тире) | `mdash_symbol_to_html_mdash` | Замена символа тире на HTML-сущность |
| | `mdash` | Обработка тире после слов, кавычек, скобок и пунктуации |
| | `mdash_2` | Обработка тире после переноса строки |
| | `mdash_3` | Обработка тире после знаков восклицания, многоточия и т.д. |
| | `iz_za_pod` | Расстановка дефисов в предлогах (из-за, из-под) |
| | `to_libo_nibud` | Расстановка дефисов в неопределённых местоимениях (кто-то, что-либо, зачем-нибудь) |
| | `koe_kak` | Расстановка дефисов в словах (кое-как, кой-кого, всё-таки) |
| | `ka_de_kas` | Расстановка дефисов с частицами (-ка, -де, -кась) |
| **Date** (Даты) | `years` | Обработка периодов дат с тире и пробелами (с 1990-2000 гг.) |
| | `mdash_month_interval` | Расстановка тире в периодах месяцев (январь-февраль) |
| | `nbsp_and_dash_month_interval` | Обработка периодов дней с тире (10-15 января) |
| | `nobr_year_in_date` | Привязка года к дате (01.01.2023) |
| | `space_after_year` | Добавление пробела после года (2023 года) |
| | `nbsp_after_year_abbr` | Неразрывный пробел после года с сокращением «г.» |
| | `nbsp_after_year_abbr` | Привязка сокращения "г." к году (2023 г.) |
| **Etc** (Разное) | `acute_accent` | Добавление акцента к буквам (ударе́ние) |
| | `word_sup` | Форматирование надстрочного текста после символа ^ |
| | `century_period` | Обработка диапазона веков с тире (XIX-XX вв.) |
| | `time_interval` | Обработка временных интервалов (12:30-14:45) |
| | `split_number_to_triads` | Разбиение длинных чисел на триады (1 000 000) |
| | `expand_no_nbsp_in_nobr` | Удаление неразрывных пробелов в тегах nobr/nowrap |
| | `nobr_to_nbsp` | Преобразование тегов nobr в неразрывные пробелы |
| **Nobr** (Неразрывные конструкции) | `nowrap` | Глобальное отключение переносов (по умолчанию отключено) |
| | `super_nbsp` | Привязка союзов и предлогов к следующим словам |
| | `nbsp_in_the_end` | Привязка союзов и предлогов к предыдущим словам в конце предложения |
| | `phone_builder` | Форматирование номеров телефонов (8 800 123-45-67) |
| | `phone_builder_v2` | Альтернативный формат номеров телефонов (+7 999 123-45-67) |
| | `ip_address` | Объединение IP-адресов в неразрывные блоки |
| | `dots_for_surname_abbr` | Автоматическая расстановка точек в инициалах фамилий |
| | `spaces_nobr_in_surname_abbr` | Привязка инициалов к фамилиям с неразрывными пробелами |
| | `nbsp_before_particle` | Неразрывный пробел перед частицами (ли, бы, же и т.д.) |
| | `nbsp_v_kak_to` | Исправление написания "как то:" на "как&nbsp;то:" |
| | `nbsp_celsius` | Привязка символа градуса к числу (25 °C) |
| | `hyphen_nowrap_in_small_words` | Обрамление коротких слов с дефисом в неразрывные блоки |
| | `hyphen_nowrap` | Отмена переноса для слов с дефисом |
| | `twosym_abbr` | Неразрывный пробел перед двухсимвольными аббревиатурами |
| **Number** (Числа) | `minus_between_nums` | Замена дефиса на минус между числами |
| | `minus_in_numbers_range` | Обработка диапазонов чисел с минусом (1...-5) |
| | `auto_times_x` | Замена x на символ × в размерных единицах (10×20) |
| | `numeric_sub` | Форматирование нижних индексов (H₂O) |
| | `numeric_sup` | Форматирование верхних индексов (м²) |
| | `dimensions_sup` | Верхние индексы для единиц измерения (м², см³) |
| | `simple_fraction` | Замена дробей на символы (½, ¼, ¾) |
| | `math_chars` | Замена математических символов (≠, ≤, ≥, ≈, ±) |
| | `thinsp_between_number_triads` | Разделение триад чисел узкими пробелами (1 000 000) |
| | `thinsp_between_no_and_number` | Узкий пробел между № и числом (№ 123) |
| | `thinsp_between_sect_and_number` | Узкий пробел между § и номером (§ 42) |
| **OptAlign** (Оптическое выравнивание) | `oa_oquote` | Оптическое выравнивание открывающей кавычки (добавляет отступы и выравнивание) |
| | `oa_obracket_coma` | Оптическое выравнивание для пунктуации (скобки и запятые) |
| | `oa_obracket_coma_extra` | Дополнительное выравнивание для скобок и запятых |
| | `oa_oquote_extra` | Дополнительная обработка кавычек после тегов |
| | `all` | Групповая настройка всех правил оптического выравнивания |
| | `layout` | Выбор между inline-стилями и CSS-классами |
| **Punctuation** (Пунктуация) | `auto_comma` | Автоматическая расстановка запятых перед "а", "но" |
| | `punctuation_marks_limit` | Ограничение количества восклицательных, вопросительных знаков и точек (максимум 3 подряд) |
| | `punctuation_marks_base_limit` | Удаление лишних запятых, двоеточий и точек с запятой |
| | `hellip` | Замена трёх точек на символ многоточия (…) |
| | `fix_excl_quest_marks` | Замена порядка знаков "!?" на "?!" |
| | `fix_double_marks` | Исправление сдвоенных знаков препинания на одиночные |
| | `fix_brackets` | Удаление лишних пробелов внутри скобок |
| | `fix_brackets_space` | Добавление пробела перед открывающей скобкой |
| | `dot_on_end` | Добавление точки в конце текста, если её нет (по умолчанию отключено) |
| **Quote** (Кавычки) | `quotes_outside_a` | Обработка кавычек вне тега `<a>` |
| | `open_quote` | Преобразование открывающих кавычек |
| | `close_quote` | Преобразование закрывающих кавычек |
| | `close_quote_adv` | Обработка специальных случаев закрывающих кавычек (с тегами, пробелами, знаками препинания) |
| | `open_quote_adv` | Обработка специальных случаев открывающих кавычек (с пробелами) |
| | `close_quote_adv_2` | Дополнительная обработка закрывающих кавычек (последний проход) |
| | `quotation` | Преобразование внутренних кавычек в лапки и дюймы |
| **Space** (Пробелы) | `nobr_twosym_abbr` | Неразрывный пробел перед двухсимвольными аббревиатурами |
| | `remove_space_before_punctuationmarks` | Удаление пробелов перед знаками препинания |
| | `autospace_after_comma` | Добавление пробела после запятой |
| | `autospace_after_pmarks` | Пробел после знаков препинания (кроме точки) |
| | `autospace_after_dot` | Пробел после точки (с исключениями для доменов) |
| | `autospace_after_hellips` | Пробел после троеточий с восклицательными/вопросительными знаками |
| | `many_spaces_to_one` | Удаление лишних пробелов и табуляций |
| | `clear_percent` | Удаление пробела перед знаком процента |
| | `nbsp_before_open_quote` | Неразрывный пробел перед открывающей кавычкой |
| | `nbsp_before_month` | Неразрывный пробел между числом и месяцем |
| | `spaces_on_end` | Удаление пробелов в конце текста |
| | `no_space_after_hellip` | Удаление пробела после многоточия после открывающей кавычки |
| | `space_after_year` | Пробел после года (например, "2023года" → "2023 года") |
| **Symbol** (Символы) | `tm_replace` | Замена (tm) на символ торговой марки ™ |
| | `r_sign_replace` | Замена (R) на символ зарегистрированной торговой марки ® |
| | `copy_replace` | Замена (c) на символ копирайта © |
| | `apostrophe` | Замена апострофа на правильный символ (’) |
| | `degree_f` | Форматирование градусов Фаренгейта (75F → 75 °F) |
| | `euro_symbol` | Замена символа евро на HTML-сущность &euro; |
| | `arrows_symbols` | Замена стрелок (->, <-, →, ←) на HTML-сущности |
| | `no_inches` | Расстановка дюйма после числа |
| **Text** (Текст) | `auto_links` | Автоматическое преобразование URL в кликабельные ссылки |
| | `email` | Преобразование email-адресов в кликабельные ссылки |
| | `no_repeat_words` | Удаление повторяющихся слов (по умолчанию отключено) |
| | `paragraphs` | Обработка абзацев (оборачивание в теги `<p>`) |
| | `breakline` | Обработка переносов строк (вставка тегов `<br>`) |

### Использование

```php
$typograph = new \Emuravjev\Mdash\Typograph();
$typograph->setup([
   'OptAlign.all' => 'off',
   'Text.paragraphs' => 'off',
   'Text.breakline' => 'off',
   'Number.numeric_sub' => 'off'
]);
$typograph->set_text('Текст "к которому" применить - типограф.');

// типографируем
$result = $typograph->apply();

// выводим результат
echo $result;
```

---
### Запуск тестов

Для установки модулей для тестирования с помощью Composer, выполните команду:
```bash
 composer install
```
Для запуска тестов, выполните команду:
```bash
 composer test
```
или аналогичную команду:
```bash
./vendor/bin/phpunit